<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Trang qu·∫£n l√Ω h·ªá th·ªëng</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f6f9;
    }
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 200px;
      height: 100vh;
      background-color: #007bdb;
      color: white;
      padding-top: 20px;
    }
    .sidebar a {
      display: block;
      color: white;
      padding: 12px 20px;
      text-decoration: none;
      font-weight: 500;
    }
    .sidebar a:hover {
      background-color: #005fa3;
    }
    .topbar {
      margin-left: 200px;
      background-color: #007bdb;
      color: white;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .dashboard {
      margin-left: 200px;
      padding: 20px;
    }
    .card-group {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .card {
      flex: 1;
      min-width: 220px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 20px;
      text-align: center;
    }
    .card h4 {
      margin: 0 0 8px;
    }
    .section-title {
      margin-top: 30px;
      margin-bottom: 12px;
      font-size: 18px;
      font-weight: bold;
    }
    .stat-blocks {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .block {
      flex: 1;
      min-width: 200px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <a href="#">POS B√°n H√†ng</a>
    <a href="#" id="home-link">Trang Ch·ªß</a>
    <a href="#" id="order-link">T·∫°o ƒë∆°n h√†ng</a>
    <a href="/products" data-link>S·∫£n ph·∫©m</a>
    <a href="/customer" >Kh√°ch h√†ng</a>
    <a href="#">Nh·∫≠p kho</a>
    <a href="/inventory" data-link>T·ªìn kho</a>
    <a href="#">Doanh s·ªë</a>
    <a href="#">Thu chi</a>
    <a href="/profit" data-link>L·ª£i nhu·∫≠n</a>

    <% if (user.role === 'owner') { %>
      <li><a href="/settings">‚öôÔ∏è Thi·∫øt l·∫≠p</a></li>
    <% } %>
  </div>

  <div class="topbar">
    <div><strong>üíº QU·∫¢N L√ù B√ÅN H√ÄNG VLXD</strong></div>
    <p style="margin-top: 30px; font-weight: 500; color: #e2e6ea;">
      üîê B·∫°n ƒëang ƒëƒÉng nh·∫≠p v·ªõi quy·ªÅn: <strong><%= user.role %></strong>
    </p>
    <div class="header-bar">
      <div class="user-dropdown">
        <span class="user-name">üî• Xin ch√†o, <b><%= user.name %></b> (<%= user.role %>) ‚ñº</span>
        <div class="dropdown-menu">
          <a href="/account">T√†i kho·∫£n</a>
          <a href="/logout">ƒêƒÉng xu·∫•t</a>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard">
    <h1>Danh s√°ch s·∫£n ph·∫©m</h1>
    <form action="/products" method="GET">
      <input type="text" name="search" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m...">
      <button type="submit">T√¨m ki·∫øm</button>
    </form>
    <table>
      <thead>
        <tr>
          <th>T√™n s·∫£n ph·∫©m</th>
          <th>M√£ s·∫£n ph·∫©m</th>
          <th>S·ªë l∆∞·ª£ng</th>
          <th>Gi√° b√°n</th>
          <th>Danh m·ª•c</th>
          <th>Nh√† s·∫£n xu·∫•t</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        <% products.forEach(product => { %>
          <tr>
            <td><%= product.name %></td>
            <td><%= product.sku %></td>
            <td><%= product.quantity %></td>
            <td><%= product.price %></td>
            <td><%= product.category %></td>
            <td><%= product.manufacturer %></td>
            <td>
              <a href="/products/detail/<%= product._id %>">Xem</a>
              <a href="/products/edit/<%= product._id %>">S·ª≠a</a>
              <form action="/products/delete/<%= product._id %>" method="POST" style="display:inline;">
                <button type="submit">X√≥a</button>
              </form>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
    <p>S·ªë s·∫£n ph·∫©m: <%= products.length %></p>
    <a href="/products/create">T·∫°o s·∫£n ph·∫©m m·ªõi</a>
  </div>

  <script>
    // Hi·ªÉn th·ªã form khi nh·∫•n n√∫t "ƒê·∫∑t h√†ng"
    document.getElementById('create-order-btn').addEventListener('click', function() {
      const form = document.getElementById('add-order-form');
      form.style.display = form.style.display === 'none' ? 'block' : 'none'; // ·∫®n/hi·ªán form
    });

    // T·∫°o event cho "Xu·∫•t Excel"
    document.getElementById('export-excel').addEventListener('click', () => {
      alert('Ch·ª©c nƒÉng xu·∫•t Excel ƒëang ph√°t tri·ªÉn!');
    });

    // H√†m t√¨m ki·∫øm v√† hi·ªÉn th·ªã k·∫øt qu·∫£ t·ª´ server
    function searchAndDisplayResults(inputElement, url, datalistId) {
      inputElement.addEventListener('input', function () {
        const query = inputElement.value; // L·∫•y gi√° tr·ªã ng∆∞·ªùi d√πng nh·∫≠p v√†o √¥ t√¨m ki·∫øm

        if (query.length > 0) {
          // G·ª≠i y√™u c·∫ßu t√¨m ki·∫øm danh s√°ch s·∫£n ph·∫©m c√≥ t√™n ch·ª©a t·ª´ kh√≥a ng∆∞·ªùi d√πng nh·∫≠p v√†o
          fetch(url + '?query=' + query)
            .then(response => response.json())  // X·ª≠ l√Ω k·∫øt qu·∫£ tr·∫£ v·ªÅ d∆∞·ªõi d·∫°ng JSON
            .then(data => {
              const datalist = document.getElementById(datalistId);
              datalist.innerHTML = ''; // X√≥a d·ªØ li·ªáu c≈© trong datalist

              // Th√™m c√°c k·∫øt qu·∫£ t√¨m ki·∫øm v√†o datalist
              data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.name;  // Hi·ªÉn th·ªã t√™n s·∫£n ph·∫©m
                datalist.appendChild(option);  // Th√™m option v√†o datalist
              });
            })
            .catch(error => console.error('Error:', error)); // X·ª≠ l√Ω l·ªói n·∫øu c√≥
        }
      });
    }

    document.addEventListener('DOMContentLoaded', function () {
      const customerInput = document.getElementById('customer');
      const productInput = document.getElementById('product');
      const userInput = document.getElementById('user');

      // T√¨m ki·∫øm kh√°ch h√†ng
      searchAndDisplayResults(customerInput, '/search/customers', 'customers');
      // T√¨m ki·∫øm s·∫£n ph·∫©m
      searchAndDisplayResults(productInput, '/search/products', 'products');
      // T√¨m ki·∫øm nh√¢n vi√™n b√°n h√†ng
      searchAndDisplayResults(userInput, '/search/users', 'users');
    });
  </script>
</body>
</html>
